<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="./css/style.css">
    <script defer src="./javascript/main.js"></script>
    <title>Testing with Cypress</title>
    <link rel="icon" href="./img/cypress-icon.png" type="image/x-icon">
</head>

<body>
    <header class="main-header">
        <h1 class="main-heading">Тестване на уеб приложения със Cypress</h1>
    </header>

    <nav id="navigation-bar">
        <article class="buttons-container">
            <a href="#introduction" class="nav-button">Въведение</a>
            <a href="#why-cypress" class="nav-button">Защо Cypress?</a>
            <a href="#how-to" class="nav-button">Тестване със Cypress</a>
            <a href="#cypress-vs-selenium" class="nav-button">Cypress vs Selenium</a>
            <a href="#sources" class="nav-button">Източници</a>
        </article>
    </nav>

    <section id="introduction">
        <header class="section-heading">
            <h3>ВЪВЕДЕНИЕ</h3>
        </header>

        <article class="section-content">
            <p>
                Уеб тестването е една от най-важните части от разработката на уеб приложения.
                С повишаването на изискванията за бързо пускане на пазара, нуждата от стабилни инструменти за
                автоматизирано тестване
                се увеличава всеки ден. Съществуват множество различни инструменти с отворен код, които целят да улеснят
                процеса
                на създаване на уеб приложения. Cypress е един от тези инструменти, които бързо са утвърдили своето
                място и е сред
                популярните при уеб интеграция и end-to-end автоматизирано тестване на потребителския интерфейс. Може да
                се използва и за модулно тестване, но това е по-рядко срещаната му употреба.
                Инструментът е насочен главно към използване от разработчици и QA инженери и цели разрешаване на
                проблеми като синхронизация,
                неконсистентни тестове и много други.
            </p>
            <p>
                Cypress е изграден върху Node.js и се предлага като npm модул (което прави инсталирането и използването
                му доста бързо),
                като използва JavaScript за писане на тестовете. Това не трябва да ни притеснява, тъй като 90% от кода
                може да бъде написан
                с помощта на вградени команди, които са лесни за разбиране. Инструментът се комбинира и с jQuery
                (JavaScript библиотека)
                и наследява много от методите ѝ, което допълнително улеснява използването му.
            </p>
            <p>
                Характеристики:
            <ul>
                <li>Бързо, последователно и надеждно изпълнение на тестовете</li>
                <li>Работи директно в браузъра</li>
                <li>Изчакване на команди с цел отстраняване на проблеми с асинхронизирането</li>
                <li>Възможност за тестване на крайни случаи чрез манипулация на отговора на сървъра</li>
                <li>Записване на всяка стъпка от изпълнението на команда в команден дневник</li>
                <li>Преглеждане на видеоклипове от изпълнението на всички тестове</li>
            </ul>
            </p>
            <p>
                Недостатъци:
            <ul>
                <li>Не може да се пишат тестове на C#, Java и други езици, различни от JavaScript</li>
                <li>Не може да изпълнява тестове за 2 или повече раздела едновременно</li>
                <li>Не може да бъде използван за мобилни приложения</li>
            </ul>
            </p>
        </article>
    </section>

    <section id="why-cypress">
        <header class="section-heading">
            <h3>7 ПРИЧИНИ ДА ИЗБЕРЕМ CYPRESS</h3>
        </header>

        <article class="section-content">
            <ol>
                <li>Cypress не използва Selenium</li>
                <p>
                    Голяма част от end-to-end инструментите за тестване са базирани на Selenium. Това е и причината,
                    поради
                    която всички споделят еднакви проблеми. За да бъде Cypress различен от тях, неговата архитектура е
                    изградена от нулата. Докато Selenium изпълнява команди дистанционно през мрежата, Cypress ги
                    изпълнява в
                    същия цикъл, в който се изпълнява и тестваното приложение.
                </p>

                <li>Cypress се фокусира върху правенето на добро end-to-end тестване</li>
                <p>
                    Cypress не е нито framework за автоматизация, нито за модулно тестване на back-end услуги, тъй като
                    вече
                    съществуват страхотни инструменти, които вършат тази работа. Cypress е по-скоро специализиран в едно
                    нещо – създаване на страхотно изживяване по време на писането на “end-to-end” тестове за уеб
                    приложения.
                </p>

                <li>Cypress работи на всеки front-end framework или уебсайт</li>
                <p>
                    Cypress тества всичко, което работи в един уеб браузър. Цялата архитектура, обхващаща Cypress е
                    изградена с цел да се справя изключително добре с всеки съвременен JavaScript framework.
                    Инструментът
                    работи също толкова добре и с по-стари сървърни страници и приложения.
                </p>

                <li>Cypress тестовете се пишат само на JavaScript</li>
                <p>
                    Въпреки че всеки друг език може да бъде компилиран до JavaScript, кодът винаги се изпълнява в самия
                    браузър. В Cypress няма обвързване с различни езици или драйвери – има и винаги ще има само
                    JavaScript.
                </p>

                <li>Cypress е всичко в едно</li>
                <p>
                    Писането на end-to-end тестове изисква използването на много различни инструменти заедно. Със
                    Cypress получаваме много инструменти в един – няма да има нужда да инсталираме 10 отделни
                    инструмента и библиотеки, за да подготвим тестовия пакет. В Cypress се съдържат функциите на някои
                    от най-добрите инструменти (Mocha, Chai, Sinon.JS и т.н.), които безпроблемно работят заедно.
                </p>
                <figure>
                    <img src="./img/before-after-cypress.png" alt="Преди и след използването на Cypress">
                    <figcaption>Фиг.1 End-to-end тестването преди и след Cypress</figcaption>
                </figure>

                <li>Cypress е за разработчици и за QA инженери</li>
                <p>
                    Една от главните цели на Cypress е да превърне разработването чрез тестване в реалност за end-to-end
                    тестването. Cypress се представя най-добре, когато се използва по време на създаването на
                    приложението, което позволява писането на код да стане възможно най-бързо.
                </p>

                <li>Cypress работи много, много по-бързо</li>
                <p>
                    Архитектурните подобрения отключват възможността за правене на разработване чрез тестване с цялостни
                    end-to-end тестове за първи път. Cypress е изграден така, че тестването и разработването могат да се
                    извършват едновременно. Cypress дава възможността за по-бърза разработка, докато целият процес се
                    управлява с тестове, защото:
                <ul>
                    <li>можем да визуализираме приложението</li>
                    <li>имаме достъп до всички инструменти за разработка</li>
                    <li>промените се отразяват в реално време</li>
                </ul>
                Крайният резултат е по-бърза разработка, по-добър код и изчерпателно тестване.
                </p>
            </ol>
        </article>
    </section>

    <section id="how-to">
        <header class="section-heading">
            <h3>ТЕСТВАНЕ СЪС CYPRESS</h3>
        </header>

        <article class="section-content">
            <p>
                В този раздел ще откриете как се прави един примерен тест със Cypress, разгледан малко по-подробно - от
                инсталирането на инструмента до кода на самия тест.
            </p>

            <ol>
                <li>Инсталиране</li>
                <p>
                    Има множество начини за инсталиране на инструмента. Първият от тях е чрез npm (мениджър на пакети за
                    JavaScript) и следната команда в терминала:
                </p>
                <code class="one-line">
                    npm install cypress
                </code>
                <p>Код 1. Инсталиране чрез npm</p>
                <p>
                    Вторият вариант е чрез yarn – друг мениджър на пакети. Инсталацията чрез него отново става с една
                    команда:
                </p>
                <code class="one-line">
                    yarn add cypress
                </code>
                <p>Код 2. Инсталиране чрез yarn</p>
                <p>
                    Ако нямате инсталиран нито един от тези мениджъри, можете да инсталирате Cypress по най-класическия
                    начин – чрез директно изтегляне на архива с инсталационни файлове от
                    <a href="https://download.cypress.io/desktop" target="_blank">тук</a>.
                </p>

                <li>Отваряне</li>
                <p>
                    Ако сте използвали npm за инсталирането, Cypress се намира във вашата ./node_modules директория и
                    може да бъде отворен със следната команда:
                </p>
                <code class="one-line">
                    ./node_modules/.bin/cypress open
                </code>
                <p>Код 3. Отваряне чрез npm</p>
                <p>
                    Друг вариант е да използваме npx (package runner за npm), който е включен във версиите на npm след
                    5.2, а може да бъде инсталиран и отделно:
                </p>
                <code class="one-line">
                    npx cypress open
                </code>
                <p>Код 4. Отваряне чрез npx</p>
                <p>
                    Ако Cypress е инсталиран чрез yarn, може да бъде отворен по следния начин:
                </p>
                <code class="one-line">
                    yarn run cypress open
                </code>
                <p>Код 5. Отваряне чрез yarn</p>
                <p>
                    В случай, че сте избрали да изтеглите директно архива с файлове, просто отворете Cypress.exe и ще
                    видите следният екран:
                </p>
                <figure>
                    <img src="./img/cypress-home-screen.png" alt="Начален екран">
                    <figcaption>Фиг.2 Начален екран на Cypress</figcaption>
                </figure>

                <li>Показване на примерни тестове</li>
                <p>Когато отворим проект със Cypress за първи път, инструментът автоматично създава няколко примерни
                    теста, които демонстрират част от възможностите му:
                </p>
                <figure>
                    <img src="./img/example-tests.png" alt="Примерни тестове">
                    <figcaption>Фиг.3 Списък със създадените примерни тестове</figcaption>
                </figure>
                <p>
                    При отваряне на всеки един от тестовете, той автоматично започва да се изпълнява. Виждаме списък с
                    команди (или т.нар. “Command Log”), които се стартират последователно, както и каква част от тях са
                    изпълнени успешно. Ние можем да използваме част от тях, да ги променяме, добавяме и изтриваме:
                </p>
                <figure>
                    <img src="./img/test-actions.png" alt="Примерен тест">
                    <figcaption>Фиг.4 Списък с команди на примерен тест</figcaption>
                </figure>

                <li>Пробен тест</li>
                <p>
                    Все още не знаем нищо за писането на тестове със Cypress, но вече знаем как се изпълняват. Ще
                    напишем първия си тест, като създадем файла sample.spec.js в любимото си IDE:
                </p>
                <pre><code class="multiple-lines">
describe('My First Test', () => {
    it('Does not do much!', () => {
    expect(true).to.equal(true)
    })
})
                </code></pre>
                <p>Код 6. Създаване на sample.spec.js</p>
                <p>
                    Когато запазим нашия файл и го отворим със Cypress, би трябвало да видим как браузърът се
                    презарежда. Когато го отворим и изпълним, вече ще имаме първия си успешен тест! (Може да не прави
                    нищо полезно, но поне е успешен):
                </p>
                <figure>
                    <img src="./img/successful-test.png" alt="Успешен тест" style="width: 50%; margin-left: 0px;">
                    <figcaption>Фиг.5 Първи успешен тест</figcaption>
                </figure>
                <p>
                    Ако искаме да видим как изглежда един неуспешен тест (за първи и последен път, надяваме се), можем
                    просто да сменим на третия ред стойността в equal на false, получавайки следния резултат:
                </p>
                <figure>
                    <img src="./img/failing-test.png" alt="Неуспешен тест" style="width: 50%; margin-left: 0px;">
                    <figcaption>Фиг.6 Първи неуспешен тест</figcaption>
                </figure>
                <p>
                    Както вече видяхме в предходната стъпка, Cypress предоставя страхотна визуализация на тестове,
                    команди, заявки и много други, като показва и броят на преминатите успешно и неуспешно тестове. Това
                    е изключително удобно при големи проекти, тъй като лесно може да се групират, преглеждат и
                    визуализират тестове, което позволява и бързи промени в кода, ако са необходими.
                </p>

                <li>Първи (истински) тест</li>
                <p>
                    За да напишем един тест, трябва да имаме уеб страница, която да тестваме. За наше улеснение, Cypress
                    има вграден набор от примерни уеб приложения. За целта ще използваме уеб приложението „Kitchen
                    Sink“, което е един от тези примери.
                </p>
                <p>
                    На мястото на предишния разгледан пример, вече можем да напишем следния код, който подава адреса на
                    командата cy.visit():
                </p>
                <pre><code class="multiple-lines">
describe('My First Test', () => {
    it('Visits the Kitchen Sink', () => {
    cy.visit('https://example.cypress.io')
    })
})
                </code></pre>
                <p>Код 7. Демонстрация на cy.visit()</p>
                <p>
                    Командата е записана в “Command Log” и е изпълнена успешно. Вече имаме отворена страница и е крайно
                    време да направим нещо в нея. Нека проверим дали в някой елемент от страницата се съдържа думата
                    “type”. За тази цел използваме командата cy.contains():
                </p>
                <pre><code class="multiple-lines">
describe('My First Test', () => {
    it('finds the content "type"', () => {
    cy.visit('https://example.cypress.io')

    cy.contains('type')
    })
})
                </code></pre>
                <p>Код 8. Демонстрация на cy.contains()</p>
                <p>
                    След като сме открили линка, който съдържа търсената дума, ще се опитаме да го отворим. Към вече
                    съществуващата команда от предходния пример, добавяме и командата .click():
                </p>
                <pre><code class="multiple-lines">
describe('My First Test', () => {
    it('clicks the link "type"', () => {
    cy.visit('https://example.cypress.io')

    cy.contains('type').click()
    })
})
                </code></pre>
                <p>Код 9. Демонстрация на .click()</p>
                <p>
                    В Cypress това добавяне на команди към команди се нарича “chaining” – командите образуват „верига“,
                    която по лесен за разбиране начин показва какво точно прави нашият тест.
                </p>
                <p>
                    Нека сега да проверим дали съдържанието на даден елемент е такова, каквото искаме да бъде. За тази
                    цел трябва да направим “assertion” – вид команда, която проверява зададено условие и ако то не е
                    изпълнено, тестването се прекратява. Да напишем команда, която взима текущия адрес и да добавим към
                    нея assert команда, която проверява дали това е адреса, който очакваме да видим:
                </p>
                <pre><code class="multiple-lines">
describe('My First Test', () => {
    it('clicking "type" navigates to a new url', () => {
    cy.visit('https://example.cypress.io')

    cy.contains('type').click()

    // Should be on a new URL which includes '/commands/actions'
    cy.url().should('include', '/commands/actions')
    })
})
                </code></pre>
                <p>Код 10. Демонстрация на команда от вид "assertion"</p>
                <p>
                    Последните 3 функции, които ще добавим към нашия тест са:
                    <ul>
                        <li>cy.get() – използва се за избиране на елемент по CSS клас</li>
                        <li>cy.type() – въвежда текст в избрано поле</li>
                        <li>cy.should() – проверява дали съдържанието на даден елемент съвпада със съдържанието, подадено
                            като параметър на командата</li>
                    </ul>
                </p>
                <pre><code class="multiple-lines">
describe('My First Test', () => {
    it('Gets, types and asserts', () => {
    cy.visit('https://example.cypress.io')

    cy.contains('type').click()

    // Should be on a new URL which includes '/commands/actions'
    cy.url().should('include', '/commands/actions')

    // Get an input, type into it and verify that the value has been updated
    cy.get('.action-email')
    .type('fake@email.com')
    .should('have.value', 'fake@email.com')
    })
})
                </code></pre>
                <p>Код 11. Първи успешен тест със Cypress</p>
            </ol>
            <p>
                Вече можем да кажем, че успешно сме написали първия си тест със Cypress, който отваря уеб страница,
                намира и кликва върху линк, верифицира URL, както и поведението на елемент от страницата при подадени
                стойности.
            </p>
        </article>
    </section>

    <section id="cypress-vs-selenium">
        <header class="section-heading">
            <h3>CYPRESS VS SELENIUM</h3>
        </header>

        <article class="section-content">
            <ol>
                <li>Инсталиране</li>
                <p>
                    Всичко, което трябва да направим, за да отворим Cypress е да инсталираме .exe файла – след това вече
                    имаме всички необходими драйвери, за да подкараме първия си тест. Със Selenium обаче е малко
                    по-сложно и подготовката отнема малко повече време. Selenium е библиотека, която изисква framework
                    за работа с нея, докато Cypress предоставя всичко за изпълнението на автоматични тестове.
                </p>

                <li>Поддържани езици</li>
                <p>
                    Едно от предимствата на Selenium пред Cypress е фактът, че поддържа повечето популярни езици за
                    програмиране като Java, Perl, PHP, Python, Ruby и C#, докато Cypress поддържа само JavaScript.
                </p>

                <li>Синтаксис</li>
                <p>
                    Както вече знаем, Cypress използва Mocha и Chai, което е страхотно, ако вече сме работили с
                    JavaScript и лесно можем да започнем да работим с този инструмент. Ако сме по-добре запознати с
                    другите езици обаче, би било доста по-сложно – тогава може би по-подходящият вариант е Selenium, тъй
                    като той поддържа множество езици.
                </p>

                <li>Заплащане</li>
                <p>
                    И двата инструмента са с отворен код и повечето им функционалности могат да бъдат използвани напълно
                    безплатно. Предлагат също и различни абонаментни планове, в зависимост от инструментите, с които
                    могат да бъдат интегрирани.
                </p>

                <li>Поддържани браузъри</li>
                <p>
                    Според официалния сайт на Cypress, това са браузърите, които той поддържа:
                <ul>
                    <li>Canary</li>
                    <li>Chrome</li>
                    <li>Chromium</li>
                    <li>Edge</li>
                    <li>Edge Beta</li>
                    <li>Edge Canary</li>
                    <li>Edge Dev</li>
                    <li>Electron</li>
                    <li>Firefox</li>
                    <li>Firefox Developer Edition</li>
                    <li>Firefox Nightly</li>
                </ul>
                За съжаление инструментът не поддържа Safari и Internet Explorer (за разлика от Selenium, който поддържа
                и тях), но се очаква това да стане в близкото бъдеще.
                </p>
            </ol>
            <p>
                В заключение, Cypress е страхотен вариант за екипи, които разработват основно с JavaScript. Като
                инструмент, направен от разработчици за разработчици, Cypress е по-скоро начин за въвеждане в
                автоматизираното тестване, отколкото заместител на Selenium. Cypress е идеално приложение за end-to-end
                тестване на уеб приложения, което позволява автоматизираното тестване на всичко, което може да се отвори
                в браузър.
            </p>
        </article>
    </section>

    <section id="sources">
        <header class="section-heading">
            <h3>ИЗТОЧНИЦИ</h3>
        </header>

        <article class="section-content">
            <p>
                [1] Aashish Khetarpal, <a href="https://www.toolsqa.com/cypress/what-is-cypress/" target="_blank">"What
                    is Cypress: Introduction and Architecture"</a>, публикуван на 2020-04-04.
            </p>
            <p>
                [2] <a href="https://www.cypress.io/how-it-works" target="_blank">"7 ways Cypress is different"</a>
            </p>
            <p>
                [3] Jon Oliver, <a
                    href="https://sparkbox.com/foundry/cypress_and_axe_tutorial_automated_accessibility_testing_tools"
                    target="_blank">"Putting Your Site’s Accessibility to the Test with Cypress and Axe"</a>, публикуван
                на 2020-12-16.
            </p>
            <p>
                [4] Alex McPeak, <a href="https://crossbrowsertesting.com/blog/test-automation/selenium-vs-cypress/"
                    target="_blank">"Selenium vs. Cypress: Is WebDriver on Its Way Out?"</a>, публикуван на 2018-06-12.
            </p>
            <p>
                [5] <a href="https://www.cypress.io/" target="_blank">Официален сайт на Cypress</a>
            </p>
            <p>
                [6] <a href="https://docs.cypress.io/guides/getting-started/writing-your-first-test"
                    target="_blank">Първи тест със Cypress</a>
            </p>
        </article>
    </section>

    <footer>
        <p>Автор: Калина Каменова, СИ, 62313</p>
    </footer>

</body>

</html>